{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒê∆°n Khi·∫øu N·∫°i</title>
  <style>
    body {
      background-color: #fff6fa;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .form-box {
      position: relative;
      width: 420px;
      background: white;
      padding: 35px 40px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(255, 92, 141, 0.25);
      text-align: center;
    }

    /* N√∫t tho√°t */
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      color: #ff5c8d;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .close-btn:hover {
      color: #a01940;
      transform: scale(1.2);
    }

    h2 {
      color: #a01940;
      margin-bottom: 25px;
      font-size: 22px;
      font-weight: 700;
      text-transform: uppercase;
    }

    label {
      display: block;
      text-align: left;
      font-weight: 600;
      color: #333;
      margin-top: 15px;
      margin-bottom: 5px;
      font-size: 15px;
    }

    textarea, input[type="file"] {
      width: 100%;
      border: 1px solid #ffd6de;
      border-radius: 8px;
      padding: 10px;
      font-family: 'Segoe UI';
      font-size: 14px;
      resize: none;
    }
    textarea {
      height: 80px;
    }

    .note {
      text-align: left;
      font-size: 13px;
      color: #777;
      margin-top: 5px;
      font-style: italic;
    }

    .preview img, .preview video {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
      box-shadow: 0 2px 8px rgba(255, 92, 141, 0.25);
    }

    .btn-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 25px;
    }

    .btn {
      border: none;
      border-radius: 10px;
      padding: 10px 28px;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: 0.3s ease;
    }

    .btn-cancel {
      background: #ffd6de;
      color: #a01940;
    }

    .btn-cancel:hover {
      background: #ffb6c1;
    }

    .btn-save {
      background: #ff5c8d;
      color: white;
    }

    .btn-save:hover {
      background: #e84c7e;
    }
  </style>
</head>

<body>

  <div class="form-box">

    <!-- ‚ùå N√∫t tho√°t -->
    <button class="close-btn" onclick="window.location.href='{% url 'lich_su_lich_hen' %}'">&times;</button>

    <h2>ƒê∆†N KHI·∫æU N·∫†I</h2>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- N·ªôi dung khi·∫øu n·∫°i -->
      <label for="noi_dung">N·ªôi dung khi·∫øu n·∫°i:</label>
      <textarea id="noi_dung" name="noi_dung"
        {% if da_khieu_nai %} readonly disabled {% endif %}
      >{{ form.initial.noi_dung }}</textarea>

      <!-- Minh ch·ª©ng -->
      <label for="hinh_anh">Minh ch·ª©ng (·∫£nh ho·∫∑c video):</label>
      <input type="file" id="hinh_anh" name="minh_chung" accept="image/*,video/*"
        {% if da_khieu_nai %} disabled {% endif %}>
      <p class="note">üìé B·∫°n c√≥ th·ªÉ t·∫£i l√™n ·∫£nh ho·∫∑c video minh ch·ª©ng</p>

      <!-- Preview file -->
      <div class="preview" id="preview">
        {% if form.initial.minh_chung %}
          {% if form.initial.minh_chung.url|slice:"-4:" in ".jpg.jpeg.png"%}
            <img src="{{ form.initial.minh_chung.url }}">
          {% else %}
            <video src="{{ form.initial.minh_chung.url }}" controls></video>
          {% endif %}
        {% endif %}
      </div>

      <!-- Y√™u c·∫ßu -->
      <label for="yeu_cau">Y√™u c·∫ßu / mong mu·ªën:</label>
      <textarea id="yeu_cau" name="yeu_cau"
        {% if da_khieu_nai %} readonly disabled {% endif %}
      >{{ form.initial.yeu_cau }}</textarea>

      <!-- N√∫t -->
      <div class="btn-group">

        <!-- N√∫t h·ªßy -->
        <button type="button" class="btn btn-cancel"
          onclick="window.location.href='{% url 'lich_su_lich_hen' %}'">
          <i class="fa-solid fa-xmark"></i> H·ª¶Y
        </button>

        <!-- N√∫t g·ª≠i ‚Äî ch·ªâ hi·ªán n·∫øu CH∆ØA g·ª≠i -->
        {% if not da_khieu_nai %}
        <button type="submit" class="btn btn-save">
          <i class="fa-solid fa-paper-plane"></i> G·ª¨I KHI·∫æU N·∫†I
        </button>
        {% endif %}
      </div>

    </form>
  </div>

  <!-- Preview file realtime khi upload -->
  {% if not da_khieu_nai %}
  <script>
    const fileInput = document.getElementById('hinh_anh');
    const preview = document.getElementById('preview');

    fileInput.addEventListener('change', () => {
      preview.innerHTML = '';
      const file = fileInput.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);

      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = url;
        preview.appendChild(img);
      } else if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        preview.appendChild(video);
      }
    });
  </script>
  {% endif %}

</body>
</html>
