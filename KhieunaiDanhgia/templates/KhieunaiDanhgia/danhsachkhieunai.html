{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>L·ªãch s·ª≠ khi·∫øu n·∫°i - Punky Spa</title>

  <!-- üíñ CSS d√πng chung -->
  <link rel="stylesheet" href="{% static 'lichhen/style.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* üå∏ Hi·ªáu ·ª©ng th√¥ng b√°o */
    .message-box {
      background: #ffe4ec;
      color: #a01940;
      padding: 12px 16px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(255, 92, 141, 0.25);
      margin-bottom: 20px;
      animation: fadeOut 4s forwards;
    }
    @keyframes fadeOut {
      0% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; display: none; }
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- üîπ Sidebar (b·∫£n m·ªõi) -->
    <div class="sidebar">
      <div class="logo">
        <img src="{% static 'trangchu/logo.png' %}" alt="Logo Punky Spa">
        <h2><span class="pink">Punky</span> Spa</h2>
      </div>

      <div class="user-info">
        <i class="fa-solid fa-user"></i> {{ request.user.username }}
      </div>

      <nav>
        <!-- M·ª§C L·ªäCH H·∫∏N -->
        <button class="drop-btn">L·ªãch h·∫πn</button>
        <div class="dropdown-content">
          <a href="{% url 'lich_hen_sap_toi' %}"
             class="{% if request.path == '/lich-hen/sap-toi/' %}active{% endif %}">L·ªãch h·∫πn s·∫Øp t·ªõi</a>
          <a href="{% url 'lich_su_lich_hen' %}"
             class="{% if request.path == '/lich-hen/lich-su/' %}active{% endif %}">L·ªãch s·ª≠ l·ªãch h·∫πn</a>
          <a href="{% url 'lich_da_huy' %}"
             class="{% if request.path == '/lich-hen/da-huy/' %}active{% endif %}">L·ªãch ƒë√£ h·ªßy</a>
        </div>

        <!-- M·ª§C KHI·∫æU N·∫†I -->
        <button class="drop-btn">Khi·∫øu n·∫°i</button>
        <div class="dropdown-content">
          <a href="{% url 'danh_sach_khieu_nai' %}"
             class="{% if request.path == '/khieu-nai/danh-sach/' %}active{% endif %}">
             L·ªãch s·ª≠ khi·∫øu n·∫°i
          </a>
        </div>
      </nav>
    </div>

    <!-- üî∏ N·ªôi dung ch√≠nh -->
    <div class="main-content">
      <h2>L·ªãch s·ª≠ khi·∫øu n·∫°i</h2>

      <!-- ‚úÖ Hi·ªÉn th·ªã th√¥ng b√°o -->
      {% if messages %}
        {% for message in messages %}
          <div class="message-box">{{ message }}</div>
        {% endfor %}
      {% endif %}

      {% if khieu_nai_list %}
      <table class="schedule-table">
        <thead>
          <tr>
            <th>Th·ªùi gian</th>

            {% if request.user.is_staff or request.user.is_superuser %}
              <th>T√™n kh√°ch h√†ng</th>
              <th>SƒêT</th>
            {% endif %}

            <th>T√™n th√∫ c∆∞ng</th>
            <th>D·ªãch v·ª•</th>
            <th>Nh√¢n vi√™n ph·ª• tr√°ch</th>
            <th>L√Ω do khi·∫øu n·∫°i</th>
            <th>Tr·∫°ng th√°i</th>
              <th>Ph·∫£n h·ªìi</th>
          </tr>
        </thead>
        <tbody>
          {% for k in khieu_nai_list %}
          <tr>
            <td>{{ k.lich_hen.thoi_gian|date:"H:i d/m/Y" }}</td>

            {% if request.user.is_staff or request.user.is_superuser %}
              <td>{{ k.lich_hen.khach_hang.ho_ten }}</td>
              <td>{{ k.lich_hen.so_dien_thoai }}</td>
            {% endif %}

            <td>{{ k.lich_hen.thu_cung.ten_thucung }}</td>

            <td>
              {% for dv_lh in k.lich_hen.dv_lichhen_set.all %}
                {{ dv_lh.dich_vu.ten_dich_vu }}{% if not forloop.last %}, {% endif %}
              {% empty %}
                <em>Kh√¥ng c√≥</em>
              {% endfor %}
            </td>

            <td>
              {% if k.lich_hen.nhan_vien %}
                {{ k.lich_hen.nhan_vien.ho_ten }}
              {% else %}
                <em>Ch∆∞a ph√¢n c√¥ng</em>
              {% endif %}
            </td>

            <td>{{ k.noi_dung }}</td>

            <td>
              {% if k.trang_thai == "Ch·ªù x·ª≠ l√Ω" %}
                <span style="color:#c25e00; font-weight:600;">üïì {{ k.trang_thai }}</span>
              {% elif k.trang_thai == "ƒêang x·ª≠ l√Ω" %}
                <span style="color:#c2185b; font-weight:600;">üî¥ {{ k.trang_thai }}</span>
              {% else %}
                <span style="color:#2e7d32; font-weight:600;">‚úÖ {{ k.trang_thai }}</span>
              {% endif %}
            </td>
              <td>
              {% if k.phan_hoi %}
                {{ k.phan_hoi }}
              {% else %}
                <em>Ch∆∞a c√≥ ph·∫£n h·ªìi</em>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      {% else %}
      <p style="text-align:center; color:#777;">Hi·ªán t·∫°i b·∫°n ch∆∞a c√≥ khi·∫øu n·∫°i n√†o.</p>
      {% endif %}
    </div>
  </div>
</body>
</html>
