{% extends 'base_lhkn.html' %}
{% load static %}
{% load humanize %}

{% block title %}Lịch hẹn sắp tới - Punky Spa{% endblock %}

{% block content %}
<div class="content-wrapper">

  <h2 class="page-title">LỊCH HẸN SẮP TỚI</h2>

  <a href="{% url 'them_lich_hen' %}" class="btn-add">Thêm lịch hẹn +</a>

  {% if messages %}
  <div class="messages" id="messages">
    {% for message in messages %}
      <div class="msg {{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="table-container">
    <table class="schedule-table">
      <thead>
        <tr>
          <th>Thời gian</th>
          <th>Tên khách hàng</th>
          <th>SĐT</th>
          <th>Tên thú cưng</th>
          <th>Loài</th>
          <th>Cân nặng</th>
          <th>Dịch vụ</th>
          <th>Nhân viên</th>
          <th>Ghi chú</th>
          <th>Thao tác</th>
        </tr>
      </thead>

      <tbody>
        {% for lich in lich_hens %}
        <tr>
          <td>{{ lich.thoi_gian|date:"H:i d/m/Y" }}</td>
          <td>{{ lich.khach_hang.ho_ten }}</td>
          <td>{{ lich.so_dien_thoai }}</td>
          <td>{{ lich.thu_cung.ten_thucung }}</td>
          <td>{{ lich.thu_cung.loai }}</td>
          <td>{{ lich.thu_cung.can_nang }}</td>

          <td>
            {% for dv in lich.dv_lichhen_set.all %}
              {{ dv.dich_vu.ten_dich_vu }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              <em>-</em>
            {% endfor %}
          </td>

          <td>{% if lich.nhan_vien %}{{ lich.nhan_vien.ho_ten }}{% else %}-{% endif %}</td>

          <td>{{ lich.ghi_chu|default:"-" }}</td>

          <td class="action-icons">

    <a href="{% url 'sua_lich_hen' lich.id %}" class="edit-icon" title="Chỉnh sửa">
        <i class="fa-solid fa-pen"></i>
    </a>

    <a href="{% url 'xoa_lich_hen' lich.id %}" class="delete-icon" title="Xóa">
        <i class="fa-solid fa-trash"></i>
    </a>

</td>

        </tr>
        {% empty %}
        <tr>
          <td colspan="10" class="empty-text">Hiện tại bạn chưa có lịch hẹn nào.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- auto hide message -->
<script>
  setTimeout(function() {
    const msg = document.getElementById("messages");
    if (msg) {
      msg.style.transition = "opacity 1s ease";
      msg.style.opacity = "0";
      setTimeout(() => msg.remove(), 1000);
    }
  }, 4000);
</script>

{% endblock %}
