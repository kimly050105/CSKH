{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>L·ªãch h·∫πn s·∫Øp t·ªõi - Punky Spa</title>
  <!-- üå∏ Li√™n k·∫øt file CSS -->
  <link rel="stylesheet" href="{% static 'lichhen/style.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* üå∏ Ch·ªâ gi·ªØ l·∫°i style cho ph·∫ßn main-content v√† table */
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff5f7;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* üå∏ N·ªôi dung ch√≠nh */
    .main-content {
      flex: 1;
      padding: 40px;
      position: relative;
    }

    .main-content h2 {
      color: #ff5c8d;
      text-align: center;
      margin-bottom: 30px;
      text-transform: uppercase;
    }

    .messages {
      position: absolute;
      top: 20px;
      right: 40px;
      z-index: 10;
    }

    .messages .msg {
      padding: 10px 15px;
      border-radius: 6px;
      margin-bottom: 10px;
      color: white;
      animation: fadeOut 4s forwards;
    }

    .messages .success { background-color: #4CAF50; }
    .messages .error { background-color: #f44336; }
    .messages .warning { background-color: #ff9800; }
    .messages .info { background-color: #2196F3; }

    @keyframes fadeOut {
      0% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; display: none; }
    }

    .btn-add {
      display: inline-block;
      background-color: #ff5c8d;
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      float: right;
      margin-bottom: 20px;
      transition: 0.2s;
    }

    .btn-add:hover { background-color: #ff7da6; }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    th, td {
      padding: 12px 15px;
      text-align: center;
    }

    thead {
      background-color: #ffb6c1;
      color: #333;
    }

    tbody tr:nth-child(even) { background-color: #fff0f5; }
    tbody tr:hover { background-color: #ffe4ed; }

    .action-icons i {
      cursor: pointer;
      margin: 0 5px;
      font-size: 18px;
      color: #a61028;
      transition: 0.2s;
    }

    .action-icons i:hover { color: #ff5c8d; }

    .no-data {
      text-align: center;
      color: #777;
      padding: 20px;
    }
  </style>
</head>

<body>
<div class="container">
  <!-- üîπ Sidebar: ch·ªânh gi·ªëng 2 trang c√≤n l·∫°i -->
  <aside class="sidebar">
    <div class="logo">
      <img src="{% static 'trangchu/logo.png' %}" alt="Punky Spa">
      <h2><span class="pink">Punky</span> Spa</h2>
    </div>

    <div class="user-info">
      <i class="fa fa-user"></i> {{ request.user.username }}
    </div>

    <nav>
  <a href="{% url 'home' %}" class="{% if request.path == '/' %}active{% endif %}">Trang ch·ªß</a>

  <div class="dropdown">
    <a href="#">L·ªãch h·∫πn</a>
    <div class="dropdown-content">
      <a href="{% url 'lich_hen_sap_toi' %}" class="{% if 'lich-hen/sap-toi' in request.path %}active{% endif %}">
        L·ªãch h·∫πn s·∫Øp t·ªõi
      </a>
      <a href="{% url 'lich_su_lich_hen' %}" class="{% if 'lich-hen/lich-su' in request.path %}active{% endif %}">
        L·ªãch s·ª≠ l·ªãch h·∫πn
      </a>
      <a href="{% url 'lich_da_huy' %}" class="{% if 'lich-hen/da-huy' in request.path %}active{% endif %}">
        L·ªãch ƒë√£ h·ªßy
      </a>
    </div>
  </div>

  <div class="dropdown">
    <a href="#">Khi·∫øu n·∫°i</a>
    <div class="dropdown-content">
      <a href="{% url 'danh_sach_khieu_nai' %}" class="{% if 'khieu-nai' in request.path %}active{% endif %}">
        L·ªãch s·ª≠ khi·∫øu n·∫°i
      </a>
    </div>
  </div>
</nav>

  </aside>

  <!-- üî∏ Ph·∫ßn n·ªôi dung ch√≠nh (gi·ªØ nguy√™n y nh∆∞ b·∫£n ƒë·∫πp c·ªßa b·∫°n) -->
  <div class="main-content">
    <h2>L·ªãch h·∫πn s·∫Øp t·ªõi</h2>
    <a href="{% url 'them_lich_hen' %}" class="btn-add">Th√™m l·ªãch h·∫πn +</a>

    {% if messages %}
    <div class="messages" id="messages">
      {% for message in messages %}
        <div class="msg {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %}

    <table>
      <thead>
        <tr>
          <th>Th·ªùi gian</th>
          <th>T√™n kh√°ch h√†ng</th>
          <th>SƒêT</th>
          <th>T√™n th√∫ c∆∞ng</th>
          <th>Lo√†i</th>
          <th>C√¢n n·∫∑ng</th>
          <th>D·ªãch v·ª•</th>
          <th>Nh√¢n vi√™n</th>
          <th>Ghi ch√∫</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        {% for lich in lich_hens %}
        <tr>
          <td>{{ lich.thoi_gian|date:"H:i d/m/Y" }}</td>
          <td>{{ lich.khach_hang.ho_ten }}</td>
          <td>{{ lich.so_dien_thoai }}</td>
          <td>{{ lich.thu_cung.ten_thucung }}</td>
          <td>{{ lich.thu_cung.loai }}</td>
          <td>{{ lich.thu_cung.can_nang }}</td>
          <td>
            {% for dv in lich.dv_lichhen_set.all %}
              {{ dv.dich_vu.ten_dich_vu }}{% if not forloop.last %}, {% endif %}
            {% empty %}-{% endfor %}
          </td>
          <td>{% if lich.nhan_vien %}{{ lich.nhan_vien.ho_ten }}{% else %}-{% endif %}</td>
          <td>{{ lich.ghi_chu|default:"-" }}</td>
          <td class="action-icons">
            <a href="{% url 'sua_lich_hen' lich.id %}" title="Ch·ªânh s·ª≠a l·ªãch h·∫πn"><i class="fa fa-pencil"></i></a>
            <a href="{% url 'xoa_lich_hen' lich.id %}" title="H·ªßy l·ªãch h·∫πn" style="text-decoration:none;color:#a61028;">
              <i class="fa fa-trash"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="10" class="no-data">Hi·ªán t·∫°i b·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- üå∏ Script t·ª± ·∫©n message -->
<script>
  setTimeout(function() {
    const msg = document.getElementById("messages");
    if (msg) {
      msg.style.transition = "opacity 1s ease";
      msg.style.opacity = "0";
      setTimeout(() => msg.remove(), 1000);
    }
  }, 4000);
</script>

</body>
</html>
