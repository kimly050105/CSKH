{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>L·ªãch h·∫πn s·∫Øp t·ªõi - Punky Spa</title>
  <!-- üå∏ Li√™n k·∫øt file CSS -->
  <link rel="stylesheet" href="{% static 'lichhen/style.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* üå∏ To√†n trang */
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff5f7;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* üå∏ Sidebar */
    .sidebar {
      width: 250px;
      background-color: #ffd6e0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sidebar .logo img {
      width: 100px;
      height: auto;
    }

    .sidebar h2 {
      color: #a61028;
      margin-top: 10px;
      font-size: 24px;
    }

    .sidebar .pink {
      color: #ff5c8d;
    }

    .user-info {
      margin: 20px 0;
      font-weight: 600;
      color: #333;
    }

    nav a {
      display: block;
      width: 100%;
      padding: 10px 0;
      text-align: center;
      color: #333;
      text-decoration: none;
      border-radius: 10px;
      margin: 5px 0;
      transition: 0.3s;
    }

    nav a:hover,
    nav .active {
      background-color: #ff5c8d;
      color: white;
    }

    /* üå∏ Ph·∫ßn n·ªôi dung ch√≠nh */
    .main-content {
      flex: 1;
      padding: 40px;
      position: relative;
    }

    .main-content h2 {
      color: #ff5c8d;
      text-align: center;
      margin-bottom: 30px;
      text-transform: uppercase;
    }

    /* üå∏ Th√¥ng b√°o messages */
    .messages {
      position: absolute;
      top: 20px;
      right: 40px;
      z-index: 10;
    }

    .messages .msg {
      padding: 10px 15px;
      border-radius: 6px;
      margin-bottom: 10px;
      color: white;
      animation: fadeOut 4s forwards;
    }

    .messages .success { background-color: #4CAF50; } /* Xanh l√° */
    .messages .error { background-color: #f44336; }   /* ƒê·ªè */
    .messages .warning { background-color: #ff9800; } /* Cam */
    .messages .info { background-color: #2196F3; }    /* Xanh d∆∞∆°ng */

    /* üå∏ Hi·ªáu ·ª©ng ·∫©n sau 4s */
    @keyframes fadeOut {
      0% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; display: none; }
    }

    /* üå∏ N√∫t th√™m l·ªãch h·∫πn */
    .btn-add {
      display: inline-block;
      background-color: #ff5c8d;
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      float: right;
      margin-bottom: 20px;
      transition: 0.2s;
    }

    .btn-add:hover {
      background-color: #ff7da6;
    }

    /* üå∏ B·∫£ng hi·ªÉn th·ªã l·ªãch h·∫πn */
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    th, td {
      padding: 12px 15px;
      text-align: center;
    }

    thead {
      background-color: #ffb6c1;
      color: #333;
    }

    tbody tr:nth-child(even) {
      background-color: #fff0f5;
    }

    tbody tr:hover {
      background-color: #ffe4ed;
    }

    /* üå∏ Icon thao t√°c (s·ª≠a, x√≥a) */
    .action-icons i {
      cursor: pointer;
      margin: 0 5px;
      font-size: 18px;
      color: #a61028;
      transition: 0.2s;
    }

    .action-icons i:hover {
      color: #ff5c8d;
    }

    .action-icons form {
      display: inline;
    }

    .no-data {
      text-align: center;
      color: #777;
      padding: 20px;
    }
  </style>
</head>

<body>
<div class="container">
  <!-- üîπ Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="{% static 'trangchu/logo.png' %}" alt="Punky Spa">
      <h2><span class="pink">Punky</span> Spa</h2>
    </div>

    <div class="user-info">
      <i class="fa fa-user"></i> {{ request.user.username }}
    </div>

    <nav>
      <a href="{% url 'home' %}">Trang ch·ªß</a>
      <a href="{% url 'lich_hen_sap_toi' %}" class="active">L·ªãch h·∫πn s·∫Øp t·ªõi</a>
      <a href="{% url 'lich_su_lich_hen' %}">L·ªãch s·ª≠ l·ªãch h·∫πn</a>
      <a href="{% url 'lich_da_huy' %}">L·ªãch ƒë√£ h·ªßy</a>
    </nav>
  </aside>

  <!-- üî∏ Ph·∫ßn n·ªôi dung ch√≠nh -->
  <div class="main-content">

    <!-- üå∏ Ti√™u ƒë·ªÅ v√† n√∫t th√™m -->
    <h2>L·ªãch h·∫πn s·∫Øp t·ªõi</h2>
    <a href="{% url 'them_lich_hen' %}" class="btn-add">Th√™m l·ªãch h·∫πn +</a>

    <!-- üå∏ HI·ªÇN TH·ªä TH√îNG B√ÅO (MESSAGE DJANGO) -->
    <!-- ‚úÖ ƒêo·∫°n n√†y gi√∫p hi·ªán message (success / error) v√† t·ª± ·∫©n sau 4s -->
    {% if messages %}
    <div class="messages" id="messages">
      {% for message in messages %}
        <div class="msg {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- üå∏ B·∫£ng hi·ªÉn th·ªã danh s√°ch l·ªãch h·∫πn -->
    <table>
      <thead>
        <tr>
          <th>Th·ªùi gian</th>
          <th>T√™n kh√°ch h√†ng</th>
          <th>SƒêT</th>
          <th>T√™n th√∫ c∆∞ng</th>
          <th>Lo√†i</th>
          <th>C√¢n n·∫∑ng</th>
          <th>D·ªãch v·ª•</th>
          <th>Nh√¢n vi√™n</th>
          <th>Ghi ch√∫</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>

      <tbody>
        {% for lich in lich_hens %}
        <tr>
          <td>{{ lich.thoi_gian|date:"H:i d/m/Y" }}</td>
          <td>{{ lich.khach_hang.ho_ten }}</td>
          <td>{{ lich.so_dien_thoai }}</td>
          <td>{{ lich.thu_cung.ten_thucung }}</td>
          <td>{{ lich.thu_cung.loai }}</td>
          <td>{{ lich.thu_cung.can_nang }}</td>
          <td>
            {% for dv in lich.dv_lichhen_set.all %}
              {{ dv.dich_vu.ten_dich_vu }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              -
            {% endfor %}
          </td>
          <td>
            {% if lich.nhan_vien %}
              {{ lich.nhan_vien.ho_ten }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>{{ lich.ghi_chu|default:"-" }}</td>

          <!-- üõ†Ô∏è C·ªôt thao t√°c -->
          <td class="action-icons">
            <!-- ‚úèÔ∏è Ch·ªânh s·ª≠a -->
            <a href="{% url 'sua_lich_hen' lich.id %}" title="Ch·ªânh s·ª≠a l·ªãch h·∫πn">
              <i class="fa fa-pencil"></i>
            </a>

            <!-- üóëÔ∏è H·ªßy l·ªãch h·∫πn (POST an to√†n) -->
            <!-- üóëÔ∏è H·ªßy l·ªãch h·∫πn (hi·ªÉn th·ªã form x√°c nh·∫≠n) -->
            <a href="{% url 'xoa_lich_hen' lich.id %}"
            title="H·ªßy l·ªãch h·∫πn"
            style="text-decoration:none;color:#a61028;">
             <i class="fa fa-trash"></i>
            </a>


          </td>
        </tr>
        {% empty %}
        <tr><td colspan="10" class="no-data">Hi·ªán t·∫°i b·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- üå∏ Script t·ª± ·∫©n message sau 4 gi√¢y -->
<script>
  setTimeout(function() {
    const msg = document.getElementById("messages");
    if (msg) {
      msg.style.transition = "opacity 1s ease";
      msg.style.opacity = "0";
      setTimeout(() => msg.remove(), 1000);
    }
  }, 4000);
</script>

</body>
</html>
