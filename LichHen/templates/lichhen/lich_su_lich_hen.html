{% extends 'base_lhkn.html' %}
{% load static %}

{% block title %}Lịch sử lịch hẹn - Punky Spa{% endblock %}

{% block content %}
<div class="content-wrapper">
  <h2 class="page-title">LỊCH SỬ LỊCH HẸN</h2>

  <div class="table-container">
    <table class="schedule-table">
      <thead>
        <tr>
          <th>Thời gian</th>
          <th>Tên khách hàng</th>
          <th>SĐT</th>
          <th>Tên thú cưng</th>
          <th>Loài</th>
          <th>Dịch vụ</th>
          <th>Nhân viên phụ trách</th>
          <th>Đánh giá</th>
          <th>Khiếu nại</th>
        </tr>
      </thead>

      <tbody>
        {% for lh in lich_hens %}
        <tr>
          <td>{{ lh.thoi_gian|date:"H:i d/m/Y" }}</td>
          <td>{{ lh.khach_hang.ho_ten }}</td>
          <td>{{ lh.khach_hang.so_dien_thoai }}</td>
          <td>{{ lh.thu_cung.ten_thucung }}</td>
          <td>{{ lh.thu_cung.loai }}</td>

          <td>
            {% for dv_lh in lh.dv_lichhen_set.all %}
              {{ dv_lh.dich_vu.ten_dich_vu }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              <em>Không có</em>
            {% endfor %}
          </td>

          <td>
            {% if lh.nhan_vien %}
              {{ lh.nhan_vien.user.get_full_name }}
            {% else %}
              <em>Chưa phân công</em>
            {% endif %}
          </td>

          <td>
            <a href="{% url 'tao_danh_gia' lh.id %}" class="action-link">Đánh giá</a>
          </td>
          <td>
            <a href="{% url 'tao_khieu_nai' lh.id %}" class="action-link">Khiếu nại</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="9" class="empty-text">Không có lịch hẹn hoàn thành.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}